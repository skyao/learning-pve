---
title: "Bond"
linkTitle: "Bond"
weight: 130
date: 2021-01-18
description: >
  PVE网络中的Bond
---

参考：

https://pve.proxmox.com/pve-docs/pve-admin-guide.html#sysadmin_network_configuration

3.3.7. Linux Bond 3.3.7. Linux Bond 一节。

## Bond

Bond（也称为 NIC 组合或链路聚合）是一种将多个 NIC 绑定到单个网络设备的技术。可以实现不同的目标，例如使网络容错，提高性能或两者兼而有之。

高速硬件（如光纤通道）和相关交换硬件可能非常昂贵。通过执行链路聚合，两个 NIC 可以显示为一个逻辑接口，从而实现双倍速度。这是大多数交换机支持的本机 Linux 内核功能。如果您的节点有多个以太网端口，您可以通过将网络电缆连接到不同的交换机来分配故障点，并且在出现网络故障时，绑定连接将故障转移到一根电缆或另一根电缆。

聚合链接可以改善实时迁移延迟并提高Proxmox VE群集节点之间的数据复制速度。

有 7 种 bond 模式：

- **Round-robin**  （balance-rr）：按顺序从第一个可用网络接口 （NIC） 到最后一个网络接口从属服务器传输网络数据包。此模式提供负载平衡和容错。
- **Active-backup (active-backup):**  bond中只有一个 NIC 从属设备处于活动状态。当且仅当活动从站发生故障时，另一个从站才会变为活动状态。单个逻辑绑定接口的 MAC 地址仅在一个 NIC（端口）上外部可见，以避免网络交换机失真。此模式提供容错。
- **Broadcast (broadcast)**: 在所有从属网络接口上传输网络数据包。此模式提供容错。
- IEEE 802.3ad 动态链路聚合 （802.3ad）（LACP）：创建共享相同速度和双工设置的聚合组。根据 802.3ad 规范利用活动聚合器组中的所有从属网络接口。
- 自适应传输负载平衡（balance-tlb）：不需要任何特殊网络交换机支持的 Linux 绑定驱动程序模式。传出网络数据包流量根据每个网络接口从属设备上的当前负载（相对于速度计算）进行分配。传入流量由一个当前指定的从属网络接口接收。如果此接收从站发生故障，另一个从站将接管发生故障的接收从站的MAC地址。
- 自适应负载平衡 （balance-alb）：包括用于 IPV4 流量的 balance-tlb 和接收负载平衡 （rlb），不需要任何特殊的网络交换机支持。接收负载平衡是通过 ARP 协商实现的。绑定驱动程序在输出时拦截本地系统发送的 ARP 回复，并使用单个逻辑绑定接口中其中一个 NIC 从属设备的唯一硬件地址覆盖源硬件地址，以便不同的网络对等方对其网络数据包流量使用不同的 MAC 地址。

如果您的交换机支持 LACP （IEEE 802.3ad） 协议，则我们建议使用相应的绑定模式 （802.3ad）。否则，通常应使用主动备份模式。

对于群集网络 （Corosync），我们建议使用多个网络对其进行配置。Corosync 不需要网络冗余绑定，因为如果网络无法使用，它可以自行在网络之间切换。
